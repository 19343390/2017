

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Projections: Converting from projection to another &mdash; GeoPython - AutoGIS 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="GeoPython - AutoGIS 1 documentation" href="index.html"/>
        <link rel="next" title="Spatial queries: Point in Polygon &amp; Intersect" href="Lesson3-point-in-polygon.html"/>
        <link rel="prev" title="Table join" href="Lesson3-table-join.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> GeoPython - AutoGIS
          

          
            
            <img src="_static/logo_hy_geo_135.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2016 Autumn
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Course information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="course-info.html">General info</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Lesson1-Intro-Python-GIS.html">Introduction to Python GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson1-Geometric-Objects.html">Geometric Objects - Spatial Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-1.html">Exercise 1</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Lesson2-overview-pandas-geopandas.html">Overview of Pandas and Geopandas -modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson2-pandas-intro.html">Introduction to Pandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson2-geopandas-basics.html">Introduction to Geopandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-2.html">Exercise 2</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 3</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Lesson3-geocoding.html">Geocoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson3-table-join.html">Table join</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Projections: Converting from projection to another</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson3-point-in-polygon.html">Spatial queries: Point in Polygon &amp; Intersect</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lesson3-spatial-join.html">Spatial join</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-3.html">Exercise 3</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">GeoPython - AutoGIS</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Projections: Converting from projection to another</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/Lesson3-projections.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="projections-converting-from-projection-to-another">
<h1>Projections: Converting from projection to another<a class="headerlink" href="#projections-converting-from-projection-to-another" title="Permalink to this headline">¶</a></h1>
<p>A map projection is a systematic transformation of the latitudes and
longitudes into a plain surface. As map projections of gis-layers are
fairly often defined differently (i.e. they do not match), it is a
common procedure to redefine the map projections to be identical in both
layers. It is important that the layers have the same projection as it
makes it possible to analyze the spatial relationships between layer,
such as conduct the Point in Polygon spatial query (which we will try
next).</p>
<p>Defining a projection and changing it is easy in Geopandas. Let&#8217;s
continue working with our <a class="reference external" href="Lesson3-geocoding.html">address points</a>, and change the
Coordinate Reference System (CRS) from WGS84 into a projection called
<a class="reference external" href="http://www.maanmittauslaitos.fi/ammattilaisille/maastotiedot/koordinaatti-korkeusjarjestelmat/karttaprojektiot-tasokoordinaatistot/tasokoordinaatistot/etrs-gkn">ETRS GK-25</a>
(EPSG:3879) which uses a Gauss-Krüger projection that is (sometimes)
used in Finland.</p>
<ul class="simple">
<li>Let&#8217;s first read the data from the Shapefile that we <a class="reference external" href="Lesson3-table-join.html">created previously</a></li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="c1"># Filepath to the addresses Shapefile</span>
<span class="n">fp</span> <span class="o">=</span> <span class="s2">r&quot;/home/geo/addresses.shp&quot;</span>

<span class="c1"># Read data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>Let&#8217;s check what is the current CRS of our layer</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">crs</span>
<span class="go">{&#39;init&#39;: &#39;epsg:4326&#39;}</span>
</pre></div>
</div>
<p>Okey, so it is WGS84 (i.e. EPSG: 4326).</p>
<ul class="simple">
<li>Let&#8217;s also check the values in our <code class="docutils literal"><span class="pre">geometry</span></code> column</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="go">0           POINT (24.9301701 60.1683731)</span>
<span class="go">1           POINT (24.9418933 60.1698665)</span>
<span class="go">2    POINT (24.9774004 60.18735880000001)</span>
<span class="go">3    POINT (25.0919641 60.21448089999999)</span>
<span class="go">4           POINT (24.9214846 60.1565781)</span>
<span class="go">Name: geometry, dtype: object</span>
</pre></div>
</div>
<p>Okey, so they indeed look like lat-lon values.</p>
<ul class="simple">
<li>Let&#8217;s convert those geometries into ETRS GK-25 projection (EPSG:
3879). Changing the projection is really easy to <a class="reference external" href="http://geopandas.org/projections.html#re-projecting">do in
Geopandas</a>
with <code class="docutils literal"><span class="pre">.to_crs()</span></code> -function. As an input for the function, you
should define the column containing the geometries, i.e. <code class="docutils literal"><span class="pre">geometry</span></code>
in this case, and a <code class="docutils literal"><span class="pre">epgs</span></code> value of the projection that you want to
use.</li>
<li>Note: there is also possibility to pass the projection information as
proj4 strings or dictionaries, see more
<a class="reference external" href="http://geopandas.org/projections.html#coordinate-reference-systems">here</a></li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Let&#39;s take a copy of our layer</span>
<span class="n">data_proj</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Reproject the geometries by replacing the values with projected ones</span>
<span class="n">data_proj</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_proj</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="n">epsg</span><span class="o">=</span><span class="mi">3879</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>Let&#8217;s see how they look now</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data_proj</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="go">0    POINT (25496123.30852197 6672833.941567578)</span>
<span class="go">1    POINT (25496774.28242895 6672999.698581985)</span>
<span class="go">2     POINT (25498746.0795546 6674947.404346379)</span>
<span class="go">3    POINT (25505098.34340289 6677972.568484426)</span>
<span class="go">4    POINT (25495639.56049686 6671520.343245601)</span>
<span class="go">Name: geometry, dtype: object</span>
</pre></div>
</div>
<p>And here we go, the numbers have changed! Now we have successfully
changed the projection of our layer into a new one.</p>
<ul class="simple">
<li>Let&#8217;s still compare the layers visually</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Plot the WGS84</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1"># Plot the one with ETRS GK-25 projection</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data_proj</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/Lesson3-projections_11_0.png" src="_images/Lesson3-projections_11_0.png" />
<img alt="_images/Lesson3-projections_11_1.png" src="_images/Lesson3-projections_11_1.png" />
<p>Indeed, they look different and our re-projected one looks much better
in Finland (not so stretced as in WGS84).</p>
<ul class="simple">
<li>Now we still need to change the crs of our GeoDataFrame into EPSG
3879 as now we only modified the values of the <code class="docutils literal"><span class="pre">geometry</span></code> column.
We can take use of fiona&#8217;s <code class="docutils literal"><span class="pre">from_epsg</span></code> -function.</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">fiona.crs</span> <span class="k">import</span> <span class="n">from_epsg</span>

<span class="c1"># Determine the CRS of the GeoDataFrame</span>
<span class="n">data_proj</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">from_epsg</span><span class="p">(</span><span class="mi">3879</span><span class="p">)</span>

<span class="c1"># Let&#39;s see what we have</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">data_proj</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;epsg:3879&#39;</span><span class="p">,</span> <span class="s1">&#39;no_defs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li><strong>Notice</strong>: The above works for most EPSG codes but as ETRS GK-25
projection is rather rare, so we still need to specify and make sure
that .prj file is having correct coordinate system information by
passing a proj4 dictionary below into it (otherwise the .prj file
would be empty):</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Pass the coordinate information</span>
<span class="n">data_proj</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;y_0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;no_defs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;x_0&#39;</span><span class="p">:</span> <span class="mi">25500000</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;lat_0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;lon_0&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;ellps&#39;</span><span class="p">:</span> <span class="s1">&#39;GRS80&#39;</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="s1">&#39;tmerc&#39;</span><span class="p">}</span>

<span class="c1"># Check it</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">data_proj</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;lat_0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;y_0&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;no_defs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;x_0&#39;</span><span class="p">:</span> <span class="mi">25500000</span><span class="p">,</span> <span class="s1">&#39;units&#39;</span><span class="p">:</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;lon_0&#39;</span><span class="p">:</span> <span class="mi">25</span><span class="p">,</span> <span class="s1">&#39;proj&#39;</span><span class="p">:</span> <span class="s1">&#39;tmerc&#39;</span><span class="p">,</span> <span class="s1">&#39;ellps&#39;</span><span class="p">:</span> <span class="s1">&#39;GRS80&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>Finally, let&#8217;s save our projected layer into a Shapefile so that we
can use it later.</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Ouput file path</span>
<span class="n">outfp</span> <span class="o">=</span> <span class="s2">r&quot;/home/geo/addresses_epsg3879.shp&quot;</span>

<span class="c1"># Save to disk</span>
<span class="n">data_proj</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">outfp</span><span class="p">)</span>
</pre></div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Lesson3-point-in-polygon.html" class="btn btn-neutral float-right" title="Spatial queries: Point in Polygon &amp; Intersect" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Lesson3-table-join.html" class="btn btn-neutral" title="Table join" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Henrikki Tenkanen.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>