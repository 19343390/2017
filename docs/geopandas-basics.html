

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basics of Geopandas - working with spatial data &mdash; Geo-Python 1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Geo-Python 1 documentation" href="index.html"/>
        <link rel="next" title="Exercise 2" href="Exercise-2.html"/>
        <link rel="prev" title="Basics of Pandas" href="pandas-intro.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Geo-Python
          

          
            
            <img src="_static/logo_hy_geo_135.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                2016 Autumn
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Course information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="course-info.html">General info</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 1</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Intro-Python-GIS.html">Introduction to Python GIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="Geometric-Objects.html">Geometric Objects - Spatial Data Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-1.html">Exercise 1</a></li>
</ul>
<p class="caption"><span class="caption-text">Lesson 2</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Lesson2-GeoDataFrames.html">Introduction to Pandas and Geopandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="pandas-intro.html">Basics of Pandas</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Basics of Geopandas - working with spatial data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#downloading-and-extracting-data">Downloading and extracting data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reading-a-shapefile">Reading a Shapefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#coordinate-reference-system-crs">Coordinate reference system (CRS)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-a-shapefile">Writing a Shapefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#geometries-in-geopandas">Geometries in Geopandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-geometries-into-a-geodataframe">Creating geometries into a GeoDataFrame</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Exercise-2.html">Exercise 2</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Geo-Python</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Basics of Geopandas - working with spatial data</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/geopandas-basics.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="basics-of-geopandas-working-with-spatial-data">
<h1>Basics of Geopandas - working with spatial data<a class="headerlink" href="#basics-of-geopandas-working-with-spatial-data" title="Permalink to this headline">¶</a></h1>
<div class="section" id="downloading-and-extracting-data">
<h2>Downloading and extracting data<a class="headerlink" href="#downloading-and-extracting-data" title="Permalink to this headline">¶</a></h2>
<p>For this lesson we are using data that you can download from <a class="reference external" href="https://github.com/Automating-GIS-processes/Lesson-2-Geo-DataFrames/raw/master/data/Data.zip">here</a>.
Once you have downloaded the Data.zip file into your home directory, you can unzip the file using the <code class="docutils literal"><span class="pre">unzip</span></code> command in the Terminal window.</p>
<blockquote>
<div><div class="code bash highlight-default"><div class="highlight"><pre><span></span>$ cd $HOME
$ unzip Data.zip
$ ls Data
DAMSELFISH_distributions.dbf   DAMSELFISH_distributions.prj
DAMSELFISH_distributions.sbn   DAMSELFISH_distributions.sbx
DAMSELFISH_distributions.shp   DAMSELFISH_distributions.shp.xml
DAMSELFISH_distributions.shx
</pre></div>
</div>
</div></blockquote>
<p>The Data folder includes a Shapefile called <strong>DAMSELFISH_distribution.shp</strong> (and files related to it).</p>
<p>Let&#8217;s start now working with spatial data using geopandas.</p>
</div>
<div class="section" id="reading-a-shapefile">
<h2>Reading a Shapefile<a class="headerlink" href="#reading-a-shapefile" title="Permalink to this headline">¶</a></h2>
<p>Spatial data can be read easily with geopandas using <code class="docutils literal"><span class="pre">gpd.from_file()</span></code>
-function:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Import necessary modules</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Set filepath</span>
<span class="n">fp</span> <span class="o">=</span> <span class="s2">r&quot;C:\HY-Data\HENTENKA\Data\AutoGIS16\Data\DAMSELFISH_distributions.shp&quot;</span>

<span class="c1"># Read file using gpd.read_file()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

<span class="c1"># Let&#39;s see what datatype is our &#39;data&#39; variable</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">geopandas</span><span class="o">.</span><span class="n">geodataframe</span><span class="o">.</span><span class="n">GeoDataFrame</span>
</pre></div>
</div>
<p>Okey so from the above we can see that our <code class="docutils literal"><span class="pre">data</span></code> -variable is a
<strong>GeoDataFrame</strong>. GeoDataFrame extends the functionalities of
<strong>pandas.DataFrame</strong> in a way that it is possible to use and handle
spatial data within pandas (hence the name geopandas). GeoDataFrame have
some special features and functions that are useful in GIS.</p>
<ul class="simple">
<li>Let&#8217;s take a look at our data and print the first 5 rows using the
<code class="docutils literal"><span class="pre">head()</span></code> -function prints the first 5 rows by default</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">              binomial category  \</span>
<span class="go">0   Stegastes leucorus       VU</span>
<span class="go">1   Stegastes leucorus       VU</span>
<span class="go">2   Stegastes leucorus       VU</span>
<span class="go">3  Chromis intercrusma       LC</span>
<span class="go">4  Chromis intercrusma       LC</span>

<span class="go">                                            citation      class_name compiler  \</span>
<span class="go">0  International Union for Conservation of Nature...  ACTINOPTERYGII     IUCN</span>
<span class="go">1  International Union for Conservation of Nature...  ACTINOPTERYGII     IUCN</span>
<span class="go">2  International Union for Conservation of Nature...  ACTINOPTERYGII     IUCN</span>
<span class="go">3  International Union for Conservation of Nature...  ACTINOPTERYGII     IUCN</span>
<span class="go">4  International Union for Conservation of Nature...  ACTINOPTERYGII     IUCN</span>

<span class="go">  dist_comm     family_nam genus_name  \</span>
<span class="go">0      None  POMACENTRIDAE  Stegastes</span>
<span class="go">1      None  POMACENTRIDAE  Stegastes</span>
<span class="go">2      None  POMACENTRIDAE  Stegastes</span>
<span class="go">3      None  POMACENTRIDAE    Chromis</span>
<span class="go">4      None  POMACENTRIDAE    Chromis</span>

<span class="go">                                            geometry     id_no  ...  origin  \</span>
<span class="go">0  POLYGON ((-115.6437454219999 29.71392059300007...  183963.0  ...       1</span>
<span class="go">1  POLYGON ((-105.589950704 21.89339825500002, -1...  183963.0  ...       1</span>
<span class="go">2  POLYGON ((-111.159618439 19.01535626700007, -1...  183963.0  ...       1</span>
<span class="go">3  POLYGON ((-80.86500229899997 -0.77894492099994...  183793.0  ...       1</span>
<span class="go">4  POLYGON ((-67.33922225599997 -55.6761029239999...  183793.0  ...       1</span>

<span class="go">  phylum_nam rl_update seasonal  source   species_na  subpop  subspecies  \</span>
<span class="go">0   CHORDATA    2012.1        1    None     leucorus    None        None</span>
<span class="go">1   CHORDATA    2012.1        1    None     leucorus    None        None</span>
<span class="go">2   CHORDATA    2012.1        1    None     leucorus    None        None</span>
<span class="go">3   CHORDATA    2012.1        1    None  intercrusma    None        None</span>
<span class="go">4   CHORDATA    2012.1        1    None  intercrusma    None        None</span>

<span class="go">  tax_comm  year</span>
<span class="go">0     None  2010</span>
<span class="go">1     None  2010</span>
<span class="go">2     None  2010</span>
<span class="go">3     None  2010</span>
<span class="go">4     None  2010</span>

<span class="go">[5 rows x 24 columns]</span>
</pre></div>
</div>
<ul class="simple">
<li>Let&#8217;s also take a look how our data looks like on a map. If you just
want to explore your data on a map, you can use <code class="docutils literal"><span class="pre">.plot()</span></code> -function
in geopandas that creates a simple map out of the data (uses
matplotlib as a backend):</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure">
<a class="reference internal image-reference" href="_images/damselfish-simple-map.PNG"><img alt="_images/damselfish-simple-map.PNG" src="_images/damselfish-simple-map.PNG" style="width: 60%;" /></a>
</div>
</div>
<div class="section" id="coordinate-reference-system-crs">
<h2>Coordinate reference system (CRS)<a class="headerlink" href="#coordinate-reference-system-crs" title="Permalink to this headline">¶</a></h2>
<p>GeoDataFrame that is read from a Shapefile contains <em>always</em> (well not
always but should) information about the coordinate system in which the
data is projected.</p>
<ul class="simple">
<li>We can see the current coordinate reference system from <code class="docutils literal"><span class="pre">.crs</span></code>
attribute:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="go">{&#39;init&#39;: &#39;epsg:4326&#39;}</span>
</pre></div>
</div>
<p>Okey, so from this we can see that the data is something called
<strong>epsg:4326</strong>. The EPSG number (<em>&#8220;European Petroleum Survey Group&#8221;</em>) is
a code that tells about the coordinate system of the dataset. &#8220;<a class="reference external" href="http://www.epsg.org/">EPSG
Geodetic Parameter Dataset</a> is a collection of
definitions of coordinate reference systems and coordinate
transformations which may be global, regional, national or local in
application&#8221;. EPSG-number 4326 that we have here belongs to the WGS84
coordinate system (i.e. coordinates are in decimal degrees (lat, lon)).
You can check easily different epsg-codes from <a class="reference external" href="http://spatialreference.org/ref/epsg/">this
website</a>.</p>
</div>
<div class="section" id="writing-a-shapefile">
<h2>Writing a Shapefile<a class="headerlink" href="#writing-a-shapefile" title="Permalink to this headline">¶</a></h2>
<p>Writing a new Shapefile is also something that is needed frequently.</p>
<ul class="simple">
<li>Let&#8217;s select 50 first rows of the input data and write those into a
new Shapefile by first selecting the data using index slicing and
then write the selection into a Shapefile with <code class="docutils literal"><span class="pre">gpd.to_file()</span></code>
-function:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Create a output path for the data</span>
<span class="n">out</span> <span class="o">=</span> <span class="s2">r&quot;/home/geo/DAMSELFISH_distributions_SELECTION.shp&quot;</span>

<span class="c1"># Select first 50 rows</span>
<span class="n">selection</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">50</span><span class="p">]</span>

<span class="c1"># Write those rows into a new Shapefile (the default output file format is Shapefile)</span>
<span class="n">selection</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Task:</strong> Open the Shapefile now in QGIS that has been installed into
our computer instance, and see how the data looks like.</p>
</div>
<div class="section" id="geometries-in-geopandas">
<h2>Geometries in Geopandas<a class="headerlink" href="#geometries-in-geopandas" title="Permalink to this headline">¶</a></h2>
<p>Geopandas takes advantage of Shapely&#8217;s geometric objects. Geometries are
stored in a column called <em>geometry</em> that is a default column name for
storing geometric information in geopandas.</p>
<ul class="simple">
<li>Let&#8217;s print the first 5 rows of the column &#8216;geometry&#8217;:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># It is possible to use only specific columns by specifying the column name within square brackets []</span>
<span class="gp">... </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="go">0    POLYGON ((-115.6437454219999 29.71392059300007...</span>
<span class="go">1    POLYGON ((-105.589950704 21.89339825500002, -1...</span>
<span class="go">2    POLYGON ((-111.159618439 19.01535626700007, -1...</span>
<span class="go">3    POLYGON ((-80.86500229899997 -0.77894492099994...</span>
<span class="go">4    POLYGON ((-67.33922225599997 -55.6761029239999...</span>
<span class="go">Name: geometry, dtype: object</span>
</pre></div>
</div>
<p>Since spatial data is stored as Shapely objects, <strong>it is possible to use
all of the functionalities of Shapely module</strong> that we practiced
earlier.</p>
<ul class="simple">
<li>Let&#8217;s print the areas of the first 5 polygons:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Make a selection that contains only the first five rows</span>
<span class="n">selection</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<ul class="simple">
<li>We can iterate over the selected rows using a specific
<code class="docutils literal"><span class="pre">.iterrows()</span></code> -function in (geo)pandas:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">selection</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
<span class="gp">... </span>    <span class="c1"># Calculate the area of the polygon</span>
<span class="gp">... </span>    <span class="n">poly_area</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span>
<span class="gp">... </span>    <span class="c1"># Print information for the user</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Polygon area at index </span><span class="si">{0}</span><span class="s2"> is: </span><span class="si">{1:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">poly_area</span><span class="p">))</span>
<span class="go">Polygon area at index 0 is: 19.396</span>
<span class="go">Polygon area at index 1 is: 6.146</span>
<span class="go">Polygon area at index 2 is: 2.697</span>
<span class="go">Polygon area at index 3 is: 87.461</span>
<span class="go">Polygon area at index 4 is: 0.001</span>
</pre></div>
</div>
<ul class="simple">
<li>Let&#8217;s create a new column into our GeoDataFrame where we calculate
and store the areas individual polygons:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Empty column for area</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
<ul class="simple">
<li>Let&#8217;s iterate over the rows and calculate the areas</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="c1"># Update the value in &#39;area&#39; column with area information at index</span>
    <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;area&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">area</span>
</pre></div>
</div>
<ul class="simple">
<li>Let&#8217;s see the first 2 rows of our &#8216;area&#8217; column</li>
</ul>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">0    19.3963</span>
<span class="go">1     6.1459</span>
<span class="go">Name: area, dtype: object</span>
</pre></div>
</div>
<ul class="simple">
<li>Let&#8217;s check what is the mean and the max of those areas using
familiar functions from our previous numpy lessions</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">max_area</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">min_area</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;area&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Max area: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">Mean area: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">max_area</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">min_area</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="go">Max area: 1493.2</span>
<span class="go">Mean area: 19.96</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-geometries-into-a-geodataframe">
<h2>Creating geometries into a GeoDataFrame<a class="headerlink" href="#creating-geometries-into-a-geodataframe" title="Permalink to this headline">¶</a></h2>
<p>Since geopandas takes advantage of Shapely geometric objects it is
possible to create a Shapefile from a scratch by passing Shapely&#8217;s
geometric objects into the GeoDataFrame. This is useful as it makes it
easy to convert e.g. a text file that contains coordinates into a
Shapefile.</p>
<ul class="simple">
<li>Let&#8217;s create an empty <code class="docutils literal"><span class="pre">GeoDataFrame</span></code>.</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Import necessary modules first</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="k">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Polygon</span>
<span class="kn">import</span> <span class="nn">fiona</span>

<span class="c1"># Create an empty geopandas GeoDataFrame</span>
<span class="n">newdata</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">()</span>

<span class="c1"># Let&#39;s see what&#39;s inside</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">newdata</span><span class="p">)</span>
<span class="n">Empty</span> <span class="n">GeoDataFrame</span>
<span class="n">Columns</span><span class="p">:</span> <span class="p">[]</span>
<span class="n">Index</span><span class="p">:</span> <span class="p">[]</span>
</pre></div>
</div>
<p>The GeoDataFrame is empty since we haven&#8217;t placed any data inside.</p>
<ul class="simple">
<li>Let&#8217;s create a new column called <code class="docutils literal"><span class="pre">geometry</span></code> that will contain our
Shapely objects:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Create a new column called &#39;geometry&#39; to the GeoDataFrame</span>
<span class="n">newdata</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Let&#39;s see what&#39;s inside</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">newdata</span><span class="p">)</span>
<span class="n">Empty</span> <span class="n">GeoDataFrame</span>
<span class="n">Columns</span><span class="p">:</span> <span class="p">[</span><span class="n">geometry</span><span class="p">]</span>
<span class="n">Index</span><span class="p">:</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Now we have a geometry column in our GeoDataFrame but we don&#8217;t have any
data yet.</p>
<ul class="simple">
<li>Let&#8217;s create a Shapely Polygon repsenting the Helsinki Senate square
that we can insert to our GeoDataFrame:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Coordinates of the Helsinki Senate square in Decimal Degrees</span>
<span class="n">coordinates</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">24.950899</span><span class="p">,</span> <span class="mf">60.169158</span><span class="p">),</span> <span class="p">(</span><span class="mf">24.953492</span><span class="p">,</span> <span class="mf">60.169158</span><span class="p">),</span> <span class="p">(</span><span class="mf">24.953510</span><span class="p">,</span> <span class="mf">60.170104</span><span class="p">),</span> <span class="p">(</span><span class="mf">24.950958</span><span class="p">,</span> <span class="mf">60.169990</span><span class="p">)]</span>

<span class="c1"># Create a Shapely polygon from the coordinate-tuple list</span>
<span class="n">poly</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>
<span class="n">POLYGON</span> <span class="p">((</span><span class="mf">24.950899</span> <span class="mf">60.169158</span><span class="p">,</span> <span class="mf">24.953492</span> <span class="mf">60.169158</span><span class="p">,</span> <span class="mf">24.95351</span> <span class="mf">60.170104</span><span class="p">,</span> <span class="mf">24.950958</span> <span class="mf">60.16999</span><span class="p">,</span> <span class="mf">24.950899</span> <span class="mf">60.169158</span><span class="p">))</span>
</pre></div>
</div>
<p>Okey, so now we have appropriate Polygon -object.</p>
<ul class="simple">
<li>Let&#8217;s insert the polygon into our &#8216;geometry&#8217; column in our
GeoDataFrame:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Insert the polygon into &#39;geometry&#39; -column at index 0</span>
<span class="n">newdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;geometry&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">poly</span>

<span class="c1"># Let&#39;s see what we have now</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">newdata</span><span class="p">)</span>
                                            <span class="n">geometry</span>
<span class="mi">0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">24.950899</span> <span class="mf">60.169158</span><span class="p">,</span> <span class="mf">24.953492</span> <span class="mf">60.16</span><span class="o">...</span>
</pre></div>
</div>
<p>Now we have a GeoDataFrame with Polygon that we can export to a
Shapefile.</p>
<ul class="simple">
<li>Let&#8217;s add another column to our GeoDataFrame called <code class="docutils literal"><span class="pre">Location</span></code> with
text <em>Senaatintori</em>.</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Add a new column and insert data</span>
<span class="n">newdata</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Senaatintori&#39;</span>

<span class="c1"># Let&#39;s check the data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">newdata</span><span class="p">)</span>
                                            <span class="n">geometry</span>      <span class="n">Location</span>
<span class="mi">0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">24.950899</span> <span class="mf">60.169158</span><span class="p">,</span> <span class="mf">24.953492</span> <span class="mf">60.16</span><span class="o">...</span>  <span class="n">Senaatintori</span>
</pre></div>
</div>
<p>Okey, now we have additional information that is useful to be able to
recognice what the feature represents.</p>
<p>Before exporting the data it is useful to <strong>determine the spatial
reference system for the GeoDataFrame.</strong></p>
<p>As was shown earlier, GeoDataFrame has a property called <em>.crs</em> that
shows the coordinate system of the data which is empty (None) in our
case since we are creating the data from the scratch:</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">newdata</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="go">None</span>
</pre></div>
</div>
<ul class="simple">
<li>Let&#8217;s add a crs for our GeoDataFrame. A Python module called
<strong>fiona</strong> has a nice function called <code class="docutils literal"><span class="pre">from_epsg()</span></code> for passing
coordinate system for the GeoDataFrame. Next we will use that and
determine the projection to WGS84 (epsg code: 4326):</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Import specific function &#39;from_epsg&#39; from fiona module</span>
<span class="kn">from</span> <span class="nn">fiona.crs</span> <span class="k">import</span> <span class="n">from_epsg</span>

<span class="c1"># Set the GeoDataFrame&#39;s coordinate system to WGS84</span>
<span class="n">newdata</span><span class="o">.</span><span class="n">crs</span> <span class="o">=</span> <span class="n">from_epsg</span><span class="p">(</span><span class="mi">4326</span><span class="p">)</span>

<span class="c1"># Let&#39;s see how the crs definition looks like</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">newdata</span><span class="o">.</span><span class="n">crs</span><span class="p">)</span>
<span class="p">{</span><span class="s1">&#39;init&#39;</span><span class="p">:</span> <span class="s1">&#39;epsg:4326&#39;</span><span class="p">,</span> <span class="s1">&#39;no_defs&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
</pre></div>
</div>
<ul class="simple">
<li>Finally, we can export the data using GeoDataFrames <code class="docutils literal"><span class="pre">.to_file()</span></code>
-function. The function works similarly as numpy or pandas, but here
we only need to provide the output path for the Shapefile. Easy isn&#8217;t
it!:</li>
</ul>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Determine the output path for the Shapefile</span>
<span class="n">outfp</span> <span class="o">=</span> <span class="s2">r&quot;C:\HY-Data\HENTENKA\Data\Senaatintori.shp&quot;</span>

<span class="c1"># Write the data into that Shapefile</span>
<span class="n">newdata</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>Now we have successfully created a Shapefile from the scratch using only
Python programming. Similar approach can be used to for example to read
coordinates from a text file (e.g. points) and create Shapefiles from
those automatically.</p>
<p><strong>Task:</strong> check the output Shapefile in QGIS and make sure that the
attribute table seems correct.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Exercise-2.html" class="btn btn-neutral float-right" title="Exercise 2" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="pandas-intro.html" class="btn btn-neutral" title="Basics of Pandas" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Henrikki Tenkanen &amp; David Whipp.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>